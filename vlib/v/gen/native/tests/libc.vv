// because of an issue with checker, all C.* functions have to be declared first
fn C.isalpha(c int) int
fn C.isdigit(c int) int
fn C.malloc(n u64) voidptr
fn C.free(ptr voidptr)
fn C.memset(ptr voidptr, c int, n u64) voidptr

fn main() {
	charutil()
	memory()
	index_expr_test()
}

fn index_expr_test() {
	unsafe {
		mut buf := &u8(C.malloc(2))
		buf[0] = 1
		buf[1] = 2
		assert buf[0] == 1
		assert buf[1] == 2
		mut buf2 := malloc_noscan(2)
		buf2[0] = 3
		buf2[1] = 4
		assert buf2[0] == 3
		assert buf2[1] == 4
	}
}


fn charutil() {
	// only linux and windows support linking right now
	$if linux || windows {
		// ascii for `V`
		v_is_alpha := C.isalpha(86)
		assert v_is_alpha != 0

		null_is_alpha := C.isalpha(0)
		assert null_is_alpha == 0

		// ascii for `3`
		three_is_digit := C.isdigit(51)
		assert three_is_digit != 0
	}
}

fn memory() {
	// only linux and windows support linking right now
	$if linux || windows {
		// allocate some memory
		buf := &int(C.malloc(100))
		assert buf != unsafe { nil }

		C.memset(buf, 0, 100)
		assert *buf == 0

		unsafe {
			*buf = 123456
			*(buf + sizeof(int)) = 100
		}
		assert *buf == 123456
		assert *(buf + sizeof(int)) == 100
		C.free(voidptr(buf))
	}
}
